import pandas as pd
import random

# -------------------------------------------------------------------------------
# [1] 월별 운세 템플릿 (좋은 운, 보통 운, 나쁜 운에 따라 자동으로 들어갈 문구들)
# -------------------------------------------------------------------------------
# 길운(좋은 운)일 때 월별 흐름
GOOD_FLOW = [
    "새로운 계획을 세우고 실천에 옮기기 좋은 달입니다.", "귀인의 도움으로 막혔던 일이 풀립니다.", "재물운이 따르니 주머니가 두둑해집니다.",
    "가정에 경사가 있고 웃음꽃이 핍니다.", "이동수가 있으나 좋은 방향이니 걱정 마세요.", "문서운이 좋아 계약이나 합격 소식이 있습니다.",
    "건강이 좋아지고 활력이 넘치는 시기입니다.", "뜻밖의 횡재수가 있어 즐거움이 따릅니다.", "주변 사람들에게 인정을 받고 명예가 오릅니다.",
    "하던 일에 성과가 나타나기 시작합니다.", "장거리 여행이나 출장을 가면 득이 됩니다.", "한 해를 마무리하며 큰 결실을 맺습니다."
]

# 평운(보통 운)일 때 월별 흐름
NORMAL_FLOW = [
    "큰 욕심을 부리지 않으면 평안한 달입니다.", "돌다리도 두들겨 보고 건너는 신중함이 필요합니다.", "지출이 늘어날 수 있으니 관리가 필요합니다.",
    "가까운 사람과의 말실수를 조심해야 합니다.", "현상 유지에 힘쓰는 것이 가장 좋습니다.", "작은 병이 큰 병이 되지 않도록 건강을 챙기세요.",
    "노력한 만큼의 대가는 반드시 돌아옵니다.", "잠시 휴식을 취하며 재충전의 시간을 가지세요.", "새로운 일보다는 하던 일에 집중하세요.",
    "친구와 다툼이 있을 수 있으니 양보하세요.", "서두르지 말고 순리대로 풀어나가세요.", "차분하게 내년을 준비하는 것이 좋습니다."
]

# 흉운(조심해야 할 운)일 때 월별 흐름
BAD_FLOW = [
    "매사 언행을 조심하고 자중해야 하는 달입니다.", "건강에 유의하고 무리한 운동은 삼가세요.", "재물의 손실이 우려되니 투자는 금물입니다.",
    "믿었던 사람에게 실망할 수 있으니 마음을 비우세요.", "먼 여행은 피하고 집안 단속을 철저히 하세요.", "구설수에 휘말릴 수 있으니 남의 말은 하지 마세요.",
    "계획대로 되지 않아 답답할 수 있으나 참으세요.", "도난이나 분실 사고를 주의해야 합니다.", "새로운 일을 벌이지 말고 수성해야 합니다.",
    "이성 문제로 골치 아픈 일이 생길 수 있습니다.", "무리한 욕심은 화를 부르니 마음을 비우세요.", "기도하는 마음으로 차분히 보내면 액을 면합니다."
]

# -------------------------------------------------------------------------------
# [2] 엑셀 파일 읽고 자동 채우기
# -------------------------------------------------------------------------------
try:
    # 엑셀 파일 불러오기
    df = pd.read_excel("db.xlsx", dtype={'code': str})
    print("📂 db.xlsx 파일을 읽었습니다. 작업을 시작합니다...")

    # 월별 데이터 저장할 리스트
    month_data = {f"month_{i}": [] for i in range(1, 13)}

    # 각 줄(점괘)을 하나씩 읽으면서 분석
    for index, row in df.iterrows():
        title = str(row['title'])
        
        # 제목에 좋은 단어가 있으면 '길운', 나쁜 단어가 있으면 '흉운'으로 판단
        good_keywords = ['꽃', '달', '용', '금', '봄', '왕', '단비', '보물', '풍년', '득', '순풍', '여의주']
        bad_keywords = ['잃은', '함정', '불', '마른', '놀란', '도적', '상한', '깨진', '가뭄', '서산']

        is_good = any(k in title for k in good_keywords)
        is_bad = any(k in title for k in bad_keywords)

        if is_good:
            selected_flow = GOOD_FLOW
        elif is_bad:
            selected_flow = BAD_FLOW
        else:
            selected_flow = NORMAL_FLOW

        # 1월~12월 데이터를 채워넣음 (약간씩 순서를 섞어서 자연스럽게 만듦)
        # *주의* 144개가 다 똑같지 않게 하기 위해 랜덤으로 순서를 살짝 섞음
        daily_luck = selected_flow[:] # 복사
        random.shuffle(daily_luck)    # 순서 섞기
        
        for i in range(1, 13):
            month_data[f"month_{i}"].append(daily_luck[i-1])

    # 기존 데이터에 월별 데이터 합치기
    for col, values in month_data.items():
        df[col] = values

    # 새로운 파일로 저장
    df.to_excel("db_final.xlsx", index=False)
    print("🎉 성공! 'db_final.xlsx' 파일이 생성되었습니다!")
    print("이제 이 파일을 db.xlsx로 이름을 바꿔서 사용하면 됩니다.")

except Exception as e:
    print(f"❌ 오류 발생: {e}")